---
milestone: v3.4
audited: 2026-01-31T21:00:00Z
status: passed
scores:
  requirements: 13/13
  phases: 3/3
  integration: 4/4
  flows: 1/1
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt: []
---

# Milestone v3.4 "Check Katapult" — Audit Report

## Phase Verification Summary

| Phase | Goal | Status | Score |
|-------|------|--------|-------|
| 21 — Pi Hardware Research | Resolve hardware questions via SSH testing | PASSED | 5/5 |
| 22 — Core Detection Engine | check_katapult() with helpers and USB recovery | PASSED | 5/5 |
| 23 — TUI Integration | K key handler with safety gates in device config | PASSED | 5/5 |

All 3 phases verified with no gaps, no anti-patterns, no stubs or TODOs.

## Requirements Coverage

| Requirement | Description | Phase | Status |
|-------------|-------------|-------|--------|
| RES-01 | sysfs path resolution documented with working code | 21 | ✓ Satisfied |
| RES-02 | Serial substring extraction verified across modes | 21 | ✓ Satisfied |
| RES-03 | Timing measurements recorded | 21 | ✓ Satisfied |
| RES-04 | flashtool.py -r behavior documented | 21 | ✓ Satisfied |
| RES-05 | Beacon probe exclusion confirmed | 21 | ✓ Satisfied |
| DET-01 | check_katapult tri-state return | 22 | ✓ Satisfied |
| DET-02 | flashtool.py -r bootloader entry | 22 | ✓ Satisfied |
| DET-03 | katapult_ device polling | 22 | ✓ Satisfied |
| DET-04 | USB sysfs reset recovery | 22 | ✓ Satisfied |
| DET-05 | KatapultCheckResult dataclass | 22 | ✓ Satisfied |
| HELP-01 | _resolve_usb_sysfs_path helper | 22 | ✓ Satisfied |
| HELP-02 | _usb_sysfs_reset helper | 22 | ✓ Satisfied |
| HELP-03 | _poll_for_serial_device helper | 22 | ✓ Satisfied |

TUI requirements (TUI-01 through TUI-05) verified via Phase 23 success criteria:

| Requirement | Description | Status |
|-------------|-------------|--------|
| TUI-01 | K key triggers Katapult check | ✓ Satisfied |
| TUI-02 | Warning about bootloader mode | ✓ Satisfied |
| TUI-03 | Confirmation defaults to No | ✓ Satisfied |
| TUI-04 | Tri-state result display | ✓ Satisfied |
| TUI-05 | Service lifecycle guaranteed | ✓ Satisfied |

## Cross-Phase Integration

| Wiring | Status |
|--------|--------|
| Phase 21 research → Phase 22 timing constants | ✓ Exact match (250ms, 5s, 500ms, 5s) |
| Phase 21 algorithms → Phase 22 helpers | ✓ Implemented (sysfs resolution, serial regex, USB reset) |
| Phase 22 check_katapult() → Phase 23 K handler | ✓ Signature matches, all args provided |
| Phase 22 KatapultCheckResult → Phase 23 result display | ✓ All tri-states handled (True/False/None) |

## E2E Flow

**User checks Katapult on device:** 8 steps verified, no breaks.

K press → device connection check → warning → confirm (default No) → stop Klipper → check_katapult() → display result → restart Klipper → return to config screen

## Open Items (Non-Blocking)

Documented in Phase 21 research, deferred by design:
- RP2040 bootloader behavior (STM32 verified, RP2040 deferred to avoid disrupting Nitehawk)
- sysfs authorized without sudo (udev rules optimization deferred)

Neither blocks the milestone or future phases.

## Tech Debt

None accumulated.

---
*Audited: 2026-01-31*
