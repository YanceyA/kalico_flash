# External Integrations

**Analysis Date:** 2026-01-25

## APIs & External Services

**Filament Management:**
- Spoolman (spool tracking and weight-based monitoring)
  - URL: `http://192.168.50.50:7912/`
  - Sync rate: 5 seconds
  - Integrated via Moonraker plugin
  - Macro: `macros/spoolman.cfg` handles spool selection
  - Environment: Fixed LAN IP (192.168.50.50)

**Web UI Ecosystem:**
- Fluidd (app.fluidd.xyz)
  - CORS domain: `*://app.fluidd.xyz`
  - Web-deployed, hosted at `~/fluidd/`
  - Connects to Moonraker API at port 7125

- Tools Annex Engineering (calibration tools)
  - CORS domains: `https://tools.annex.engineering`, `http://tools.annex.engineering`
  - Used for importing macros and configurations

## Data Storage

**Databases:**
- Not directly used - flat file configuration model
- Virtual SD card: `~/printer_data/gcodes/` (local filesystem)
- Configuration backups: `config_backups/` directory in repo

**File Storage:**
- Local filesystem only
- Gcode files: `~/printer_data/gcodes/`
- Bed mesh calibrations: Auto-saved in `printer.cfg` SAVE_CONFIG block (`bed_mesh default`)
- Input shaper results: Auto-saved in SAVE_CONFIG block
- Beacon model: Auto-saved in SAVE_CONFIG block

**Tuning Data:**
- `adxl_results/` directory - Accelerometer frequency response data
- `ShakeTune_results/` directory - Resonance tuning outputs
- Auto-generated by ShakeTune plugin (`features/shake_tune.cfg`)

**Configuration History:**
- `config_backups/` - Timestamped snapshots (auto-generated by Moonraker)
- Git repo - Primary versioning via `autocommit.sh`

## Caching

**None detected** - Klipper operates with real-time data flow

## Authentication & Identity

**Auth Provider:**
- None for printer control itself
- Moonraker optional auth (disabled in this config: `force_logins: false`)
- CORS-based access control only

**Authorization:**
- Trusted clients (IP whitelist): `10.0.0.0/8`, `127.0.0.1`, `192.168.0.0/16`, local network ranges
- Tailscale access enabled: `100.83.130.56`, `100.86.124.17`, `100.102.19.48`, `100.92.169.64`
- OctoPrint API compatibility mode enabled (basic compatibility layer)

## Hardware Integrations

**Probe:**
- Beacon Surface Scanner RevH (eddy current probe)
  - Serial: `/dev/serial/by-id/usb-Beacon_Beacon_RevH_FC2690B64E5737374D202020FF0A4026-if00`
  - Config: `hardware/probe_beacon.cfg`
  - X offset: 0mm (centered on nozzle)
  - Y offset: 19mm (forward of nozzle)
  - Home position: 145, 135 (center of bed with Y probe offset)
  - Contact homing with automatic calibration
  - Thermal compensation via ambient coil temperature sensor
  - Integrated with adaptive mesh and QGL

**MCUs:**
- Octopus Pro (STM32H723xx main board)
  - Serial: `/dev/serial/by-id/usb-Klipper_stm32h723xx_29001A001151313531383332-if00`
  - Config: `hardware/mcu_octopus.cfg`
  - Hosts XY motion, bed heater, primary fans
  - Restart method: `command`

- Nitehawk36 (RP2040 toolhead board)
  - Serial: `/dev/serial/by-id/usb-Klipper_rp2040_30333938340A53E6-if00`
  - Config: `hardware/mcu_nitehawk36.cfg`
  - Hosts extruder motor, hotend heater, toolhead fans
  - Restart method: `command`
  - Alias: `nhk`

**Sensors:**
- Beacon accelerometer (XY motor sync feedback)
  - Dual-axis motion detection for microstep synchronization
  - Config: `features/motors_sync.cfg`, `hardware/sensor_accelerometers.cfg`

- Bed thermistor (Generic 3950 NTC)
  - Pin: `PF3` on Octopus
  - MPC tuning auto-saved

- Hotend thermistor (PT1000)
  - Pin: `nhk:gpio29` on Nitehawk36
  - Pullup: 2200Î© (Nitehawk-specific)
  - MPC tuning auto-saved

- Chamber temperature sensor (NTC thermistor)
  - Config: `hardware/sensor_temp_chamber.cfg`

- Bed corner temperature sensors
  - Multiple sensors for skew correction
  - Config: `hardware/sensor_bed.cfg`

**Stepper Motors:**
- XY dual-motor configuration (CoreXY kinematic)
  - Motors: LDO-36STH17 steppers with TMC2209 drivers
  - Synchronization: Beacon accelerometer feedback via motors-sync
  - Config: `hardware/stepper_xy.cfg`

- Z quad-motor (4-drive gantry)
  - Motors: Hybrid steppers
  - Config: `hardware/stepper_z.cfg`
  - QGL compensation on all 4 motors

- Extruder
  - Motor: LDO-36STH17 (5mm shaft Bondtech)
  - Driver: TMC2209 (on Nitehawk36)
  - Sherpa Mini gearbox (50:8)
  - Pressure advance: smooth time 0.01s
  - Config: Extruder section in `printer.cfg` (lines 54-95)

**Fans:**
- Bed fans (SSR-controlled, dual speed): `hardware/fans_bed.cfg`
- Hotend print cooling fan: `hardware/fans_print_cooling.cfg`
- Hotend heater cooling fan: `hardware/fans_hotend.cfg`
- Octopus board heatsink fans: `hardware/fans_octopus_stepper.cfg`
- PTC chamber heater fan: `hardware/fans_ptc_heater.cfg`

**Heaters:**
- Bed heater (400W SSR via pin `PA3`, MPC control)
- Hotend heater (100W via `nhk:gpio9`, MPC control)
- Chamber heater (PTC with watermark control, 24V)
  - Config: `hardware/heater_chamber_ptc.cfg`

**LEDs:**
- Case lighting (addressable RGB/white)
  - Config: `hardware/leds_caselight.cfg`
  - Macro control: `macros/case_lights.cfg`

- Hotend lighting (addressable RGB)
  - Config: `hardware/leds_hotend.cfg`
  - Controlled via SET_LED commands

**Camera:**
- Logitech HD Webcam C525
  - Device: `/dev/v4l/by-id/usb-046d_HD_Webcam_C525_74A08420-video-index0`
  - Streamer: ustreamer
  - Resolution: 1280x720 (30fps max)
  - Port: 8080 (MJPG stream and snapshots)
  - Config: `crowsnest.conf`

## Monitoring & Observability

**Logging:**
- Klipper logs: `~/printer_data/logs/klippy.log`
- Moonraker logs: `~/printer_data/logs/moonraker.log`
- Crowsnest logs: `~/printer_data/logs/crowsnest.log`
- Log level: `verbose` for Crowsnest

**Telemetry:**
- Enabled in SAVE_CONFIG block (line 233: `[telemetry]` `enabled = True`)
- Kalico telemetry collection (minimal logging impact)

**Error Tracking:**
- None detected (no external error reporting service)

**Print History:**
- Moonraker history plugin enabled
- Stores print records in local database

## CI/CD & Deployment

**Hosting:**
- Self-hosted on Raspberry Pi/equivalent Linux SBC
- Printer runs on local network (192.168.x.x, Tailscale VPN access available)

**Update Management:**
- Moonraker update_manager handles all plugin updates
- Git-based updates for plugins and extensions
- Web-based updates for Fluidd UI
- Refresh interval: 168 hours (weekly check)
- Auto-refresh enabled

**Managed Services:**
- Klipper (managed by Beacon, motors-sync, ShakeTune, KlipperScreen updates)
- Moonraker (managed by core plugins)
- Crowsnest (managed by crowsnest update plugin)
- KlipperScreen (managed by KlipperScreen update)
- Spoolman (managed by Spoolman update)

**Git Integration:**
- Repository: Local git repo (primary branch `main`, PR target `master`)
- Remote: Not specified in config (upstream not configured)
- Auto-commit script: `autocommit.sh` handles backups
- Commit style: `Autocommit from YYYY-MM-DD HH:MM:SS`

## Webhooks & Callbacks

**Incoming:**
- Spoolman webhook: Filament changes and spool updates
  - Triggered via macro integration in `macros/spoolman.cfg`

**Outgoing:**
- None detected
- No external notification system configured
- Logs available via HTTP API from Moonraker

## OctoPrint Compatibility

- OctoPrint API compatibility layer enabled in Moonraker
- Provides basic compatibility for OctoPrint-compatible clients
- Config: `moonraker.conf` line 37: `[octoprint_compat]`

## Announcements & Notifications

**Moonraker Announcements:**
- Enabled with Fluidd subscription
- Delivers news/updates to UI

## Plugin Architecture

**Installed Plugins (via Moonraker):**

| Plugin | Type | Status | Purpose |
|--------|------|--------|---------|
| Beacon Klipper | Git Repo | Active (dev) | Surface scanning probe driver |
| klipper_tmc_autotune | Git Repo | Active (dev) | TMC stepper tuning automation |
| Klippain-ShakeTune | Git Repo | Active (beta) | Resonance analysis and tuning |
| MotionMinder | Git Repo | Active (dev) | Linear rail maintenance tracking |
| motors-sync | Git Repo | Active | XY motor synchronization |
| klipper-led_effect | Git Repo | Active | RGB LED effects and control |
| Crowsnest | Git Repo | Managed | Multi-camera streaming |
| KlipperScreen | Git Repo | Managed | Touchscreen UI |
| Fluidd | Web | Managed | Web UI (stable channel) |
| Spoolman | Zip | Managed | Filament spool tracking |

## Network Configuration

**Server Bindings:**
- Moonraker: `0.0.0.0:7125` (all interfaces)
- Fluidd web: Static files at `~/fluidd/`
- Crowsnest: Streams on ports 8080-8083 (via `localhost:8080/webcam/`)

**CORS Configuration:**
- Allows: `*.local`, `*.lan` (mDNS/Bonjour)
- Allows: `https://tools.annex.engineering`, `http://tools.annex.engineering`
- Allows: `*://app.fluidd.xyz` (any protocol)

**Trusted Networks:**
- Private networks: `10.0.0.0/8`, `192.168.0.0/16`, `172.16.0.0/12`, `169.254.0.0/16`
- Link-local: `FE80::/10`, `::1/128`
- Localhost: `127.0.0.0/8`, `127.0.0.1`
- Tailscale IPs:
  - `100.83.130.56` - Android phone
  - `100.86.124.17` - Work PC
  - `100.102.19.48` - Work PC 2
  - `100.92.169.64` - Work PC

## Environment Variables

**Required (in `moonraker.conf`):**
- `spoolman_server`: `http://192.168.50.50:7912/`

**Optional (auto-detected):**
- `KLIPPER_HOME`: Default `~/printer_data/` (inferred)
- `KLIPPER_CONFIG`: Default `~/printer_data/config/` (inferred)

---

*Integration audit: 2026-01-25*
