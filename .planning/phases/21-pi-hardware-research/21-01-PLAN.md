---
phase: 21-pi-hardware-research
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/21-pi-hardware-research/21-01-SUMMARY.md
autonomous: true

must_haves:
  truths:
    - "sysfs path resolution algorithm is documented with verified Python code"
    - "MCU serial substring persistence across Klipper/Katapult modes is confirmed"
    - "Timing measurements for bootloader entry, sysfs reset, and re-enumeration are recorded"
    - "flashtool.py -r behavior under all three scenarios is documented"
    - "Beacon probe exclusion via existing prefix check is confirmed"
  artifacts:
    - path: ".planning/phases/21-pi-hardware-research/21-01-SUMMARY.md"
      provides: "Consolidated research findings for Phase 22 implementation"
  key_links:
    - from: "21-RESEARCH.md"
      to: "21-01-SUMMARY.md"
      via: "Research distilled into implementation-ready summary"
---

<objective>
Formalize the Phase 21 Pi hardware research into a summary document confirming all five requirements are satisfied.

Purpose: The research has already been completed via live SSH testing. This plan validates completeness and produces the summary that Phase 22 (Core Detection Engine) depends on.
Output: 21-01-SUMMARY.md with verified findings and implementation-ready constants/patterns.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-pi-hardware-research/21-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate research completeness and write summary</name>
  <files>.planning/phases/21-pi-hardware-research/21-01-SUMMARY.md</files>
  <action>
Read 21-RESEARCH.md and verify all five requirements (RES-01 through RES-05) have HIGH confidence findings with working code examples. Then create the phase summary with:

1. **Frontmatter**: phase, plan, status=complete, subsystem=hardware-research, affects=[22-core-detection-engine]
2. **What was done**: All five research questions answered via live SSH testing on Pi
3. **Key findings** (implementation-ready for Phase 22):
   - sysfs resolution: `/sys/class/tty/{tty}/device` symlink -> parent dir -> `authorized` file
   - Serial substring: Hex serial identical across modes; regex `usb-(?:Klipper|katapult)_[a-zA-Z0-9]+_([A-Fa-f0-9]+)`
   - Timing constants: flashtool -r ~1.4s, sysfs reset ~1s, re-enum ~0.5-1s; use 250ms poll, 5s timeout
   - flashtool -r: Requires Klipper stopped; on already-Katapult device: instant success (no-op)
   - Beacon: `usb-Beacon_*` prefix naturally excluded by existing `usb-Klipper_`/`usb-katapult_` check
4. **Decisions**: Use sysfs symlink approach (not udevadm); use sudo for authorized file writes
5. **Open questions**: RP2040 bootloader entry behavior (STM32 verified, RP2040 TBD)
6. **Files changed**: None (research-only phase)
  </action>
  <verify>21-01-SUMMARY.md exists and contains findings for all five requirements (RES-01 through RES-05)</verify>
  <done>Summary document created with all research findings distilled into implementation-ready format for Phase 22</done>
</task>

</tasks>

<verification>
- [ ] 21-01-SUMMARY.md exists with valid frontmatter
- [ ] All five requirements (RES-01 through RES-05) have documented findings
- [ ] Implementation-ready constants (timing values, regex patterns, algorithm steps) are captured
- [ ] Open questions (RP2040 bootloader) documented for future phases
</verification>

<success_criteria>
Phase 21 research is formalized into a summary that Phase 22 can reference for implementation constants, patterns, and algorithms.
</success_criteria>

<output>
After completion, create `.planning/phases/21-pi-hardware-research/21-01-SUMMARY.md`
</output>
