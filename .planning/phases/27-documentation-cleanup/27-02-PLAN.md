---
phase: 27-documentation-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - kflash/errors.py
autonomous: true

must_haves:
  truths:
    - "Error recovery messages reference TUI action names instead of key shortcuts"
    - "Recovery messages use 'kflash' as the command name"
    - "No recovery message references CLI flags like --device or --add-device"
  artifacts:
    - path: "kflash/errors.py"
      provides: "Error templates with TUI-appropriate recovery text"
      contains: "ERROR_TEMPLATES"
  key_links:
    - from: "kflash/errors.py"
      to: "TUI action names"
      via: "recovery_template strings"
      pattern: "(Flash Device|Add Device|Config Device|main menu)"
---

<objective>
Audit and update all error templates in errors.py so recovery messages reference TUI actions instead of CLI flags or key shortcuts.

Purpose: Complete DOC-03 — error recovery guidance matches TUI-only operation.
Output: Updated kflash/errors.py with TUI-appropriate recovery messages
</objective>

<context>
@.planning/phases/27-documentation-cleanup/27-CONTEXT.md
@kflash/errors.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and update error recovery templates</name>
  <files>kflash/errors.py</files>
  <action>
Review every entry in ERROR_TEMPLATES and update recovery messages per context decisions:
- Reference TUI action names, not specific keys (e.g., "Use Flash Device from the main menu" not "Press F")
- Use "kflash" as command name where needed
- Keep current verbosity and tone — just swap references

Specific updates needed:

1. **device_not_registered** (line 97-100): Change "Press D to view registered devices" to "Use Add Device from the main menu to register it". Change "Press A to register a new device" — remove (redundant with previous). Keep "Check device key spelling" or rephrase.

2. **device_not_connected** (line 108): Change "press A to re-register" to "use Add Device from the main menu to re-register".

3. **mcu_mismatch** (line 117): Change "Re-run menuconfig to reconfigure" — this is fine (no CLI ref). Change "Or update device registration if MCU changed" to "Or use Config Device from the main menu to update MCU". Line 3 about grep is fine (diagnostic command).

4. **printer_busy** (line 198): Change "Then re-run flash command" to "Then use Flash Device from the main menu".

5. **device_excluded** (line 207): Change "Press D to view all devices" to "Use Config Device from the main menu to manage exclusion".

6. **build_failed** (line 76-81): All recovery steps are manual terminal commands — fine, no changes needed.

7. **menuconfig_failed** (line 87-90): Manual commands — fine.

8. **service_stop_failed**, **service_start_failed**: Manual commands — fine.

9. **flash_failed** (line 144-149): "Retry flash after board enters bootloader" — fine, generic enough.

10. **verification_timeout**, **verification_wrong_prefix**: Manual diagnostics — fine.

11. **katapult_not_found**: "Falling back to make flash method" — fine.

12. **moonraker_unavailable**: Manual diagnostics — fine.

Also search the rest of errors.py for any string containing "--", "flag", or "CLI" that might need updating.
  </action>
  <verify>Search errors.py for "Press ", "--", "re-run flash command", "re-run" — none should match. Search for "main menu" — should find matches in updated templates.</verify>
  <done>All error recovery messages reference TUI action names. No key shortcuts ("Press F"), no CLI flags, no "re-run" commands. DOC-03 satisfied.</done>
</task>

</tasks>

<verification>
1. `grep -n "Press [A-Z]" kflash/errors.py` — zero matches
2. `grep -n "\-\-" kflash/errors.py` — zero matches
3. `grep -n "re-run" kflash/errors.py` — zero matches
4. `grep -n "main menu" kflash/errors.py` — matches in updated templates
</verification>

<success_criteria>
- Every recovery template uses TUI action names (Add Device, Flash Device, Config Device)
- No key shortcut references (Press F, Press D, Press A)
- No CLI flag references
- DOC-03 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/27-documentation-cleanup/27-02-SUMMARY.md`
</output>
