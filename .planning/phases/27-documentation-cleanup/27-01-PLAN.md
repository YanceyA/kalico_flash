---
phase: 27-documentation-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - CLAUDE.md
  - install.sh
autonomous: true

must_haves:
  truths:
    - "README has no CLI reference section or CLI flag examples"
    - "README documents TUI-only usage with kflash entry point"
    - "CLAUDE.md CLI Commands section replaced with TUI Menu section"
    - "CLAUDE.md Repository Structure lists actual current files"
    - "CLAUDE.md has no Future Plans section"
    - "CLAUDE.md Out of Scope accurately reflects current state"
    - "install.sh post-install message says 'Run kflash to start' with no flags"
  artifacts:
    - path: "README.md"
      provides: "TUI-only user documentation"
      contains: "kflash"
    - path: "CLAUDE.md"
      provides: "Developer guidance for TUI architecture"
      contains: "TUI Menu"
    - path: "install.sh"
      provides: "Installer with TUI-only messaging"
  key_links:
    - from: "README.md"
      to: "kflash entry point"
      via: "Quick Start section"
      pattern: "kflash"
---

<objective>
Update README.md, CLAUDE.md, and install.sh to reflect TUI-only operation. Remove all CLI flag references, CLI command tables, and outdated sections. Replace with TUI walkthrough documentation.

Purpose: Complete DOC-01, DOC-02, DOC-04 — all user-facing and developer-facing docs reflect that kflash is a TUI application with no CLI flags.
Output: Updated README.md, CLAUDE.md, install.sh
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-documentation-cleanup/27-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite README.md for TUI-only operation</name>
  <files>README.md</files>
  <action>
Rewrite README.md with these changes:

1. **Quick Start section** — Replace step 3 (`kflash --add-device`) with: "Run `kflash` — the TUI guides you through adding your first device and flashing." Step 4 becomes unnecessary, remove it.

2. **Features section** — Remove the old interactive menu mockup (lines 33-50 with numbered menu). Replace with a TUI walkthrough describing what happens when you run kflash:
   - Main screen shows device status panel (registered devices, connection status, firmware versions) and actions panel
   - Actions available: Flash Device, Flash All, Add Device, Remove Device, Config Device, Refresh Devices, Quit
   - Flash workflow: select device -> menuconfig -> build -> flash (4 phases shown inline)
   - Add device: interactive prompts for name, MCU selection from connected USB devices, flash method

3. **Remove "Skip Menuconfig" section** entirely (lines 52-61 which document the -s flag). Delete the full section including heading and body.

4. **Device Exclusion section** — Remove CLI flag examples (`kflash --exclude-device`, `kflash --include-device`). Describe exclusion via Config Device screen in TUI.

5. **Remove "CLI Reference" table** entirely (lines 138-156).

6. **Remove short flags paragraph** ("Short flags: -d KEY, -s").

7. **Print Safety section** — Change "Then re-run flash command" to "Then use Flash Device from the main menu". Remove the error output example showing `[Safety]` phase labels if desired, or keep but update recovery text.

8. **Verify Installation section** — Change `kflash --version` to just `kflash` (version shows in TUI header).

9. **Automatic Updates section** — Change "kflash is a CLI tool" to "kflash is a TUI tool" in the last paragraph.

10. **How It Works section** — Remove mention of `-s` flag. Change "When you run `kflash`" intro to describe TUI launching and user selecting an action. The 4 phases description is fine, just remove CLI references.

Keep: Out of Scope (not in README), Supported Boards, Installation, Uninstall, License, Acknowledgments sections as-is (they have no CLI references).

NOTE: There is no "Future Plans" section in the current README — no action needed for that.
  </action>
  <verify>Search README.md for CLI patterns that should not remain: "--device", "--add-device", "--list-devices", "--remove-device", "--exclude-device", "--include-device", "-d ", "-s flag", "-s,", "CLI Reference", "argparse". None should match in documentation context (install.sh --uninstall reference in Uninstall section is fine, as are markdown formatting like `--` em dashes if any).</verify>
  <done>README has zero CLI flag references. No Skip Menuconfig section. Documents TUI-only usage. Quick Start tells users to run kflash and follow the TUI.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite CLAUDE.md for TUI architecture</name>
  <files>CLAUDE.md</files>
  <action>
Update CLAUDE.md with these changes:

1. **Overview paragraph** — Change "Python CLI tool" to "Python TUI tool". Change "single-command flow" to "interactive TUI flow".

2. **Repository Structure** — First run `ls kflash/*.py` to get the actual current file list. Then replace the entire file listing with the verified structure under kflash/ package:
   ```
   kalico-flash/
   ├── kflash.py          # Entry point (shebang launcher)
   ├── install.sh         # Installer (kflash symlink to ~/.local/bin)
   ├── kflash/
   │   ├── __init__.py    # Package init
   │   ├── flash.py       # Main entry, TUI launcher
   │   ├── tui.py         # TUI main loop, input handling, screen rendering
   │   ├── screen.py      # Device config screen (edit device settings)
   │   ├── panels.py      # Panel renderer (status panel, action panel, dividers)
   │   ├── ansi.py        # ANSI escape utilities (cursor, clear, truecolor)
   │   ├── theme.py       # Color theme (truecolor palette, semantic styles)
   │   ├── models.py      # Dataclass contracts (DeviceEntry, BuildResult, etc.)
   │   ├── errors.py      # Exception hierarchy and error templates
   │   ├── output.py      # Structured output (phase labels, progress)
   │   ├── registry.py    # Device registry with atomic JSON persistence
   │   ├── discovery.py   # USB scanning and pattern matching
   │   ├── config.py      # Kconfig caching and MCU validation
   │   ├── validation.py  # Input validation, slug generation, config checks
   │   ├── build.py       # menuconfig TUI and firmware compilation
   │   ├── service.py     # Kalico service lifecycle (context manager)
   │   ├── flasher.py     # Dual-method flash operations (Katapult + make flash)
   │   └── moonraker.py   # Moonraker API client (print safety check)
   └── devices.json       # Device registry (created on first device registration)
   ```
   IMPORTANT: Verify this listing against actual `ls kflash/*.py` output. Add any files present on disk that are missing from the listing. Remove any files listed that do not exist on disk.

3. **Architecture section** — Change "Hub-and-spoke pattern: flash.py orchestrates" to describe tui.py as the main loop that dispatches actions to flash.py workflows. Keep dataclass contracts, context manager descriptions. Remove "Late imports: CLI loads modules..." (no longer relevant).

4. **Replace "CLI Commands" section** with "TUI Menu" section:
   ```
   ## TUI Menu

   Run `kflash` to launch the TUI. The main screen shows:
   - **Status panel**: Registered devices with connection status and firmware versions
   - **Actions panel**: Available operations

   Actions:
   - **Flash Device (F)** — Select a connected device, run menuconfig, build, flash
   - **Flash All (A)** — Flash all connected devices sequentially
   - **Add Device (N)** — Register a new USB device (prompts for name, selects MCU)
   - **Remove Device (X)** — Remove a registered device
   - **Config Device (C)** — Edit device settings (name, MCU, flash method, exclusion)
   - **Refresh Devices (R)** — Re-scan USB devices and update status
   - **Quit (Q)** — Exit
   ```

5. **Flash Workflow section** — Keep the 4 phases, remove any CLI flag references.

6. **Development Environment section** — Update sync command path from `kalico-flash/*.py` to `kflash/*.py` plus `kflash.py`. Update run commands from `python3 flash.py --help` to `python3 kflash.py` (launches TUI). Update local dev from `python flash.py --help` to `python kflash.py`.

7. **Remove "Future Plans (v2.0 candidates)" section** entirely.

8. **Out of Scope section** — Make these specific changes:
   - KEEP: "RPi MCU flashing (different workflow — linux process, not USB serial)" (still out of scope)
   - KEEP: "CAN bus device discovery (USB only)" (still out of scope)
   - UPDATE: "Moonraker/Fluidd UI integration (CLI only)" -> "Moonraker/Fluidd UI integration (TUI only)"
   - REMOVE: "Multi-device batch flash (one device at a time)" (Flash All now exists)
   - KEEP: "Firmware version tracking/rollback" (still out of scope)
   - KEEP: "Automatic Klipper git pull (dangerous — user manages source updates)" (still out of scope)
   - REMOVE: "Post-flash verification" from Future Plans — it is already implemented (verification_timeout/verification_wrong_prefix error templates prove this)
   - REMOVE: "Moonraker print status check" from Future Plans — it is already implemented (moonraker.py exists)

9. **Configuration Storage section** — Remove "created on first --add-device" parenthetical, change to "created on first device registration".

10. **Coding Conventions** — Keep as-is (still accurate).

11. **Exception Hierarchy** — Keep as-is.
  </action>
  <verify>
1. Search CLAUDE.md for "CLI", "--", "argparse", "flash.py --" — no CLI command references should remain. "CLI" may appear in historical context only if describing what was removed, but should not appear.
2. Run `ls kflash/*.py` and confirm every .py file listed on disk appears in the Repository Structure section.
3. Search CLAUDE.md for "Multi-device batch flash" — should not be found (removed from Out of Scope).
4. Search CLAUDE.md for "Post-flash verification" — should not be found.
5. Search CLAUDE.md for "Moonraker print status check" — should not be found.
6. Search CLAUDE.md for "Future Plans" — should not be found.
  </verify>
  <done>CLAUDE.md reflects TUI architecture. Repository Structure matches actual files on disk. No CLI references. No Future Plans section. Out of Scope accurately reflects current state: removed implemented features, kept genuine exclusions, updated CLI->TUI.</done>
</task>

<task type="auto">
  <name>Task 3: Update install.sh post-install message</name>
  <files>install.sh</files>
  <action>
Line 90: Change `echo "Run 'kflash --help' to get started"` to `echo "Run 'kflash' to start"`.

That is the only change needed. Audit the rest of install.sh — the --uninstall flag is for the installer itself (not kflash), so it stays.
  </action>
  <verify>Read install.sh line 90 and confirm it says "Run 'kflash' to start" with no --help flag.</verify>
  <done>install.sh post-install message references no CLI flags for kflash.</done>
</task>

</tasks>

<verification>
1. `grep -n "\-\-" README.md` — only matches should be in install.sh --uninstall reference within Uninstall section
2. `grep -n "CLI" CLAUDE.md` — zero matches
3. `grep -n "\-\-help" install.sh` — zero matches
4. CLAUDE.md Repository Structure lists: tui.py, screen.py, panels.py, ansi.py, theme.py, validation.py, moonraker.py
5. `grep -n "Multi-device batch flash" CLAUDE.md` — zero matches
6. `grep -n "Post-flash verification" CLAUDE.md` — zero matches
7. `grep -n "Future Plans" CLAUDE.md` — zero matches
</verification>

<success_criteria>
- README documents TUI-only usage, no CLI reference table, no flag examples, no Skip Menuconfig section
- CLAUDE.md has TUI Menu section, updated repo structure verified against filesystem, no Future Plans
- CLAUDE.md Out of Scope removes implemented features, keeps genuine exclusions
- install.sh says "Run 'kflash' to start"
- DOC-01, DOC-02, DOC-04 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/27-documentation-cleanup/27-01-SUMMARY.md`
</output>
